<include file="Public/base" />
<script src='__CONTENT__/bootstrapvalidator/dist/js/bootstrapValidator.js' language='JavaScript'>
</script>
<link rel="stylesheet" href="__CONTENT__/bootstrapvalidator/dist/css/bootstrapValidator.css" />

<link rel="stylesheet" href="__CONTENT__/bootstrap-fileinput/css/fileinput.min.css" />

<script src='__CONTENT__/bootstrap-fileinput/js/fileinput.min.js' language='JavaScript'></script>
<script src='__CONTENT__/bootstrap-fileinput/js/fileinput_locale_zh.js' language='JavaScript'></script>

<script src='__CONTENT__/js/bootbox.min.js' language='JavaScript'></script>

<script type="text/javascript">
</script>
<style>
	#tabList th {
		background: #FFF;
		vertical-align: middle;
	}
	
	#tabList td {
		vertical-align: middle;
	}
</style>

<div class="main-content">
	<div class="breadcrumbs" id="breadcrumbs">
		<ul class="breadcrumb">
			<li><i class="icon-home home-icon"></i>后台管理</li>
			<span id="span_dh">&nbsp;>&nbsp;&nbsp;系统管理&nbsp;&nbsp;>&nbsp;&nbsp;收款账号管理
			</span>
		</ul>
		<!-- .breadcrumb -->

	</div>

	<!-- 内容 -->
	<div class="page-content">
		<div class="row">

			<div class="col-xs-12 widget-main ">
				<div class="">

					<h4 class="lighter">
						 
					</h4>

				</div>
				<div class="">

					<h4 class="lighter">
						<button id="btnAdd" onclick="AddProductInfo();" class="btn btn-primary btn-info ">
							<i class="icon-bullhorn bigger-120"> 添加</i>
						</button>
					</h4>

				</div>

				<div class="table-responsive">
					<table id="tabList" class="table table-striped table-bordered table-hover datatable table-condensed">
						<thead>
							<tr>
								<th class="center">#</th>
								<th class="center">类型</th>
								<th class="center">账号</th>
								<th class="center">二维码</th>
								<th class="center">操作</th>
							</tr>
						</thead>

						<tbody>
							<tr>
								<td class="center col-xs-0 col-sm-0">1</td>

								<td class="center col-xs-2 col-sm-2">

									支付宝

								</td>

								<td class="center col-xs-3 col-sm-3">
									11111 </td>
								<td class="center col-xs-3 col-sm-3">
									<img src="/ylyl/Public/Uploads/./SystemConfig/20170623/1498201553_131615735.png" height="150" width="130" />

								</td>
								<td class="center col-xs-2 col-sm-2">
									<div class="hidden-sm hidden-xs btn-group">

										<button class="btn btn-xs btn-warning" onclick="DeleteProductInfo('12')">
											<i class="icon-remove bigger-120"></i>删除
										</button>
									</div>
								</td>
							</tr>
							<tr>
								<td class="center col-xs-0 col-sm-0">2</td>

								<td class="center col-xs-2 col-sm-2">

									微信
								</td>

								<td class="center col-xs-3 col-sm-3">
									222 </td>
								<td class="center col-xs-3 col-sm-3">
									<img src="/ylyl/Public/Uploads/./SystemConfig/20170623/1498201591_535128178.png" height="150" width="130" />

								</td>
								<td class="center col-xs-2 col-sm-2">
									<div class="btn-group">

										<button class="btn btn-xs btn-warning" onclick="DeleteProductInfo('14')">
											<i class="icon-remove bigger-120"></i>删除
										</button>
									</div>
								</td>
							</tr>
						</tbody>
					</table>

					<div>

					</div>
				</div>

				<div class="modal   fade" tabindex="-1" role="dialog" id="editModel">
					<div class="modal-dialog modal-lg">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal">
									<span aria-hidden="true">×</span><span class="sr-only">Close</span>
								</button>
								<h4 class="modal-title">维护收款账号</h4>
							</div>
							<div class="modal-body">

								<form id="Form1" class="form-horizontal" role="form" method="post" action="">
									<div class="form-group">

										<label class="col-sm-3 control-label no-padding-right" for="form-field-1"> 类型 </label>
										<div class="col-sm-9">
											<select id="txttype" name="type" class="left col-xs-8 col-sm-8">
												<option value="01">支付宝</option>
												<option value="03">微信</option>
											</select>
											<label class="middle red">*</label>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-2"> 账号</label>

										<div class="col-sm-9">
											<input type="text" id="txtcode" name="code" value="" class="col-xs-12 col-sm-9" /> <label class="middle red">*</label>
										</div>

									</div>

									<div class="form-group">
										<label class="col-sm-3 control-label  no-padding-right" for="form-field-1"> 二维码</label>

										<div class="col-sm-9">
											<input id="ShowPicAddress" name="ShowPicAddress" value="" type="file" class="file" data-show-preview="false">
											<label class="middle red">附件支持png、jpg、jpeg、gif、bif等类型图片，大小不超过3M</label>
										</div>
									</div>

							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
								<button type="button" class="btn btn-primary" onclick="SaveForm();">保存</button>
							</div>
							</form>
						</div>
						<!-- /.modal-content -->
					</div>
					<!-- /.modal-dialog -->
				</div>

			</div>
		</div>
	</div>
</div>
</div>
<script type='text/javascript'>
	var urlUploadsAppendix = "/ylyl/adminIndex.php/Home/SystemConfig/UploadsShowPicAddress";
	$("#ShowPicAddress").fileinput({
		language: 'zh', //设置语言
		uploadUrl: urlUploadsAppendix, //上传的地址
		allowedFileExtensions: ['jpg', 'gif', 'png', 'jpeg', 'bmp'], //接收的文件后缀
		showUpload: false, //是否显示上传按钮
		showCaption: true, //是否显示标题
		browseClass: "btn btn-primary", //按钮样式             
		previewFileIcon: "<i class='icon-king'></i>",
		//dropZoneEnabled: false,//是否显示拖拽区域
		//minImageWidth: 50, //图片的最小宽度
		//minImageHeight: 50,//图片的最小高度
		//maxImageWidth: 1000,//图片的最大宽度
		//maxImageHeight: 1000,//图片的最大高度
		maxFileSize: 3072, //单位为kb，如果为0表示不限制文件大小
		//minFileCount: 0,
		maxFileCount: 1, //表示允许同时上传的最大文件个数
		//enctype: 'multipart/form-data',
		validateInitialCount: true
		//msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
	});
	$("#ShowPicAddress").on("fileuploaded", function(event, data, previewId, index) {
		var flag = data.response.toString().substr(0, 1);
		var value = data.response.toString().substr(1);
		if(flag != "1") {
			alert(value);
		} else {
			// 上传没有问题  再提交
			SubmitForm(value);

		}
	});
	var FormStatus = "";

	$(function() {

		$('#Form1').bootstrapValidator({　　　
			message: 'This value is not valid',
			　feedbackIcons: {　　　　　　　　 //valid: 'glyphicon glyphicon-ok',
				　　　　　　　　 //invalid: 'glyphicon glyphicon-remove',
				　　　　　　　　 //validating: 'glyphicon glyphicon-refresh'
				　　　　　　　　},
			fields: {
				type: {
					validators: {
						notEmpty: {
							message: '类型不能为空'
						}
					}
				},
				code: {
					validators: {
						notEmpty: {
							message: '账号ID'
						}
					}
				},

			}
		});

		$('#editModel').on('show.bs.modal', function() {

		});
		$('#editModel').on('shown.bs.modal', function() {

		});
		$('#editModel').on('hide.bs.modal', function() {

		});
		$('#editModel').on('hidden.bs.modal', function() {

		});

	});

	function AddProductInfo() {
		FormStatus = "Add";
		ShowWindowsInfo();

	}

	function EditProductInfo(id) {
		if(!id) {
			return;
		}
		FormStatus = "Edit";

		ShowWindowsInfo();

		var _url = "/ylyl/adminIndex.php/Home/SystemConfig/GetGatheringInfoByID";

		$.ajax({
			type: "POST", // 用POST方式传输    
			dataType: "Text",
			url: _url, // 目标地址    
			data: {
				"ID": id
			},
			success: function(data) {
				data = eval("(" + data + ")");

				$("#txttype").val(data.type);
				$("#txtcode").val(data.code);

			}
		});
	}

	function ShowWindowsInfo() {
		//弹出窗体之前先清空
		$('#Form1')[0].reset();

		$("#editModel").modal({
			keyboard: true
		});
	}

	function SaveForm() {
		$('#Form1').data('bootstrapValidator').validate();
		var IsValid = $("#Form1").data('bootstrapValidator').isValid();
		if(IsValid) {
			// 先上传  获取到图片存放完整路径 一起提交
			if($('#ShowPicAddress').val()) {
				//先上传
				$('#ShowPicAddress').fileinput('upload');
			} else {
				SubmitForm("");
			}
		}
	}

	function SubmitForm(FileName) {
		//先保存 
		var SavaData = {
			type: $("#txttype").val(),
			code: $("#txtcode").val(),
			imgurl: FileName
		};
		var _url = "/ylyl/adminIndex.php/Home/SystemConfig/AddGatheringInfoDo";
		if(FormStatus == "Edit") {
			_url = "/ylyl/adminIndex.php/Home/SystemConfig/EditGatheringInfoDo";
		}
		$.ajax({
			type: "POST", // 用POST方式传输    
			dataType: "Text",
			url: _url, // 目标地址    
			data: SavaData,
			success: function(data) {
				var result = eval("(" + data + ")")
				if(result != "1") {
					ShowMsg(result);
				} else {
					ShowMsg('S保存成功！');
				}
			},
			error: function(data) {
				alert(data);
			}
		});
	}

	function DeleteProductInfo(id) {
		bootbox.confirm("确认删除？", function(r) {
			if(r) {
				var _url = "/ylyl/adminIndex.php/Home/SystemConfig/DeleteGatheringInfoDo";
				$.ajax({
					type: "POST", // 用POST方式传输    
					dataType: "Text",
					url: _url, // 目标地址    
					data: {
						"ID": id
					},
					success: function(data) {
						var result = eval("(" + data + ")")
						if(result != "1") {
							ShowMsg(result);
						} else {
							ShowMsg("S删除成功！");
						}
					},
					error: function(data) {
						alert(data);
					}
				});
			}
		});
	}
</script>